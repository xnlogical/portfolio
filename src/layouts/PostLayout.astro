---
import { Picture } from "astro:assets";
import type { ImageMetadata } from "astro";
import dayjs from "dayjs";
import localizedFormat from "dayjs/plugin/localizedFormat";
import Card from "../components/ui/Card.astro";
import BaseLayout from "./BaseLayout.astro";
import Tag from "../components/ui/Tag.astro";
import TerminalPrompt from "../components/ui/TerminalPrompt.astro";
import Divider from "../components/ui/Divider.astro";

export interface Props {
  title: string;
  description: string;
  publishDate: Date;
  updatedDate?: string;
  heroImage?: ImageMetadata;
  readingTime?: string;
  tags?: string[];
}

const {
  title,
  description,
  publishDate,
  updatedDate,
  heroImage,
  readingTime,
  tags,
} = Astro.props;

dayjs.extend(localizedFormat);
const displayDate = dayjs(publishDate).format("LL");
---

<BaseLayout
  title={title}
  description={description}
  image={heroImage}
  navbarActiveItemID="blog"
>
  <Card class="md:p-8">
    {
      heroImage && (
        <Picture
          widths={[400, 800, 1200]}
          src={heroImage}
          alt={title}
          class="w-full mb-6 rounded-xl shadow-sm dark:shadow-md hover:shadow-md dark:hover:shadow-lg transition duration-300"
        />
      )
    }

    <header class="mb-6">
      <h1
        class="text-3xl sm:text-4xl font-bold text-primary leading-tight mb-4"
      >
        {title}
      </h1>

      <div
        class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-muted font-mono"
      >
        <time
          datetime={publishDate.toISOString()}
          class="flex items-center gap-1.5"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          {displayDate}
        </time>

        {
          readingTime && (
            <span class="flex items-center gap-1.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-4 h-4"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
              </svg>
              {readingTime}
            </span>
          )
        }
      </div>

      {
        updatedDate && (
          <p class="mt-2 text-xs text-muted italic">Updated: {updatedDate}</p>
        )
      }

      {
        tags && tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-4">
            {tags.map((tag) => (
              <Tag tag={tag} />
            ))}
          </div>
        )
      }
    </header>

    <Divider subtle class="my-6" />

    <article
      class="prose prose-base md:prose-lg prose-zinc dark:prose-invert max-w-none
        prose-headings:font-bold prose-headings:text-primary prose-headings:scroll-mt-20
        prose-h2:text-xl prose-h2:mt-8 prose-h2:mb-3 md:prose-h2:text-2xl md:prose-h2:mt-10 md:prose-h2:mb-4
        prose-h3:text-lg prose-h3:mt-6 prose-h3:mb-2 md:prose-h3:text-xl md:prose-h3:mt-8 md:prose-h3:mb-3
        prose-p:text-secondary prose-p:leading-relaxed
        prose-a:text-accent prose-a:no-underline hover:prose-a:underline
        prose-strong:text-primary prose-strong:font-semibold
        prose-code:text-accent prose-code:bg-accent/10 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:before:content-none prose-code:after:content-none
        prose-pre:bg-surface prose-pre:border prose-pre:border-gray-300/50 prose-pre:text-sm dark:prose-pre:border-gray-700/50
        prose-blockquote:border-l-accent prose-blockquote:bg-accent/5 prose-blockquote:py-1 prose-blockquote:px-4 prose-blockquote:rounded-r
        prose-img:rounded-lg prose-img:shadow-md
        prose-li:text-secondary prose-li:marker:text-accent"
    >
      <slot />
    </article>

    <footer
      class="mt-8 pt-4 border-t border-gray-300/50 dark:border-gray-700/50"
    >
      <TerminalPrompt
        command={`cat ${title.toLowerCase().replace(/\s+/g, "-")}.md`}
        class="mt-0 pt-0 border-t-0"
      />
    </footer>
  </Card>
</BaseLayout>
